[合集 \- 经验分享(33\)](https://github.com)[1\.记一次由于操作失误致使数据库瘫痪的故障分析与解决方案2023\-09\-08](https://github.com/guoxiaoyu/p/17678340.html)[2\.网络之谜：记一次失败排查的故事2023\-11\-15](https://github.com/guoxiaoyu/p/17811098.html)[3\.你是否想知道如何应对高并发？Go语言为你提供了答案！2023\-12\-29](https://github.com/guoxiaoyu/p/17933653.html)[4\.2023年终总结：拉帮结伙，拼搏探索新机遇2023\-12\-30](https://github.com/guoxiaoyu/p/17933731.html)[5\.谁说后端不能画出美丽的动图？让我来给大家拜个年！01\-29](https://github.com/guoxiaoyu/p/17991503)[6\.【10秒开服】幻兽帕鲁全自动部署教程，难道你还想手动搭建游戏服务器吗？快来学习这个简单又快速的方法！01\-30](https://github.com/guoxiaoyu/p/17998193)[7\.踩坑指南：入门OpenTenBase之部署篇04\-10](https://github.com/guoxiaoyu/p/18116318)[8\.踩坑指南：入门OpenTenBase之监控篇04\-11](https://github.com/guoxiaoyu/p/18117472)[9\.加速博客体验：静态资源优化技巧大揭秘！04\-28](https://github.com/guoxiaoyu/p/18149525)[10\.5分钟带你了解RabbitMQ的（普通/镜像）集群06\-14](https://github.com/guoxiaoyu/p/18240661)[11\.金仓数据库全攻略：简化部署，优化管理的全流程指南06\-21](https://github.com/guoxiaoyu/p/18257320)[12\.KES数据库实践指南：探索KES数据库的事务隔离级别07\-02](https://github.com/guoxiaoyu/p/18276998)[13\.云端IDE如何重定义开发体验07\-24](https://github.com/guoxiaoyu/p/18294897)[14\.国产数据库：数字时代的科技巨擘07\-16](https://github.com/guoxiaoyu/p/18295131)[15\.浅析前端数据埋点监控：用户行为与性能分析的桥梁08\-02](https://github.com/guoxiaoyu/p/18329944)[16\.数据库与我：一段关于学习与成长的深情回顾08\-05](https://github.com/guoxiaoyu/p/18338820):[豆荚加速器](https://yirou.org)[17\.观存储历史，论数据未来08\-12](https://github.com/guoxiaoyu/p/18352499)[18\.从自建到云原生：数据管理的未来与变革08\-13](https://github.com/guoxiaoyu/p/18354003)[19\.深入分析与解决方案：缓存与数据库双写不一致问题08\-20](https://github.com/guoxiaoyu/p/18363049)[20\.小白系列：数据库基础知识解析08\-19](https://github.com/guoxiaoyu/p/18363713)[21\.智能客服的演变：从传统到向量数据库的新时代08\-21](https://github.com/guoxiaoyu/p/18370513)[22\.Cloud Studio：颠覆传统的云端开发与学习解决方案08\-28](https://github.com/guoxiaoyu/p/18382973)[23\.单元测试的入门实践与应用09\-05](https://github.com/guoxiaoyu/p/18395944)[24\.Git冲突解决技巧09\-15](https://github.com/guoxiaoyu/p/18409072)[25\.提升软件测试效率与灵活性：探索Mock测试的重要性09\-22](https://github.com/guoxiaoyu/p/18419378)[26\.从设计到代码：探索高效的前端开发工具与实践09\-28](https://github.com/guoxiaoyu/p/18425801)[27\.掌握Docker：简化KES单机安装与管理的最佳实践10\-01](https://github.com/guoxiaoyu/p/18436754)[28\.AI实战篇：Spring AI \+ 混元 手把手带你实现企业级稳定可部署的AI业务智能体10\-18](https://github.com/guoxiaoyu/p/18453559)[29\.实用小工具——快速获取数据库时间写法10\-19](https://github.com/guoxiaoyu/p/18459987)[30\.从0到1实现项目Docker编排部署10\-22](https://github.com/guoxiaoyu/p/18474742)[31\.新手入门Java自动化测试的利器：Selenium WebDriver11\-10](https://github.com/guoxiaoyu/p/18515369)[32\.程序员如何借势AI提高自己：从高效工作到技能升级的全面指南11\-11](https://github.com/guoxiaoyu/p/18526930)33\.快速上手 KSQL：轻松与数据库交互的利器11\-14收起
上次我们通过 Docker 安装了 KingbaseES 数据库，今天我们将开始学习并快速上手使用 KSQL。简单来说，KSQL 本质上是一个客户端工具，用于与数据库进行交互。启动后，我们可以像使用普通的 SQL 一样执行查询和操作，这将是一个很好的练习机会。


同时，我们也可以借此机会探索 KSQL 是否有一些特别的功能或使用方式，了解它与传统 SQL 工具的不同之处。


# Ksql快速启动


## 连接目标数据库


使用命令 `ksql -p 54321 -d test`，你就可以直接进入名为 `test` 的数据库。通过更改命令中的数据库名称参数，你可以轻松切换并进入任何其他数据库，只需替换 `-d` 后面的数据库名称即可。这种方式非常灵活，方便用户在多个数据库之间进行快速切换和操作。


![image](https://img2024.cnblogs.com/blog/1423484/202411/1423484-20241109130948439-2121632350.png)


## 基本命令


### 建表


这里我们使用的是标准的建表语句，创建表的过程与传统的 SQL 语法完全一致。



> create table todo\_info(
> id number primary key,
> todo\_info varchar(1000\) not null,
> todo\_Date date not null,
> done boolean not null default false
> )


![image](https://img2024.cnblogs.com/blog/1423484/202411/1423484-20241109130958643-643657266.png)


### 查看表结构


Ksql也有查看表结构的命令如下：`\d todo_info`


![image](https://img2024.cnblogs.com/blog/1423484/202411/1423484-20241109131009123-142342833.png)


### 变量


KSQL 支持在会话中动态添加变量，采用的是键值对（Key\-Value）结构。这意味着用户可以在会话期间定义和修改变量，并在查询和操作中灵活地使用这些变量。



> \\set flag 爱吃饭
> 
> 
> \\echo :flag


![image](https://img2024.cnblogs.com/blog/1423484/202411/1423484-20241109131018854-1601985908.png)


当然，这不仅仅包括常规的变量，也同样适用于SQL语句中的变量。接下来，我们将具体演示如何在SQL操作中使用这些变量。



> insert into todo\_info(id,todo\_info,todo\_date) values(1,:'flag',sysdate);


![image](https://img2024.cnblogs.com/blog/1423484/202411/1423484-20241109131031049-1665452154.png)


变量的使用可以显著节省你编写重复代码或值所浪费的时间，通过使用变量，你能够避免冗余操作，极大地提升开发效率。


### SQL脚本


KSQL 同样支持执行 SQL 脚本，这是其强大的功能之一。接下来，我们将通过一个实际的示例来进行测试。首先，我们需要进入 Docker 容器环境，并确保在当前用户的工作目录下编辑一个测试脚本。


需要注意的是，你也可以根据需要，编辑并使用你自己的 SQL 脚本。为了帮助你快速入门，下面展示的是一个简单的测试脚本内容：



> CREATE TABLE t1
> (
> a int,
> b int
> );
> 
> 
> INSERT INTO t1 VALUES(1,1\);
> INSERT INTO t1 VALUES(2,2\);
> 
> 
> SELECT \* FROM t1;


![image](https://img2024.cnblogs.com/blog/1423484/202411/1423484-20241109131035578-1943986566.png)


保存后，我们可以在Ksql窗口内直接执行命令：`\i text.sql`


![image](https://img2024.cnblogs.com/blog/1423484/202411/1423484-20241109131039271-1150485152.png)


这也是一个对于开发人员方便的命令。


### 生成HTML


我们可以将查询得到的结果转换为HTML格式，以便更好地进行可视化展示。考虑到你的数据库工具无法直接连接到生产数据库，而生产数据库的管理权限通常仅限于DBA（数据库管理员），因此可以让DBA导出查询结果为HTML文件供我们查看。


这样不仅能够实现数据的可视化，也能更直观地分析和展示结果。我们不妨尝试一下这个方法。



> \\H


执行命令后，我们看下查询结果。


![image](https://img2024.cnblogs.com/blog/1423484/202411/1423484-20241109131045082-1390173288.png)


浏览器直接就可以打开查看。


![image](https://img2024.cnblogs.com/blog/1423484/202411/1423484-20241109131049512-263167428.png)


如果想要还原回去，记得在执行这个命令：`\a`


![image](https://img2024.cnblogs.com/blog/1423484/202411/1423484-20241109131053456-1725240434.png)


### 统计 SQL 执行时间


在生产环境中，SQL执行时间是最常用的性能监控指标之一，通过这个指标，我们可以迅速识别出是否存在慢查询的潜在隐患。特别是在上线新版本或新功能时，分析SQL执行时间能够帮助我们及时发现性能问题，避免对系统的响应速度和稳定性产生负面影响。


接下来，我们将一起来看看如何开启这一监控功能。



> \\timing on


![image](https://img2024.cnblogs.com/blog/1423484/202411/1423484-20241109131058788-1207426266.png)


开启成功，这样就可以直接在上线前就可以隐藏掉慢查询的隐患。


### 执行计划


另一个在生产环境中不可或缺的优化工具是执行计划。执行计划能够揭示SQL查询在执行过程中是否有效利用了索引，尤其在新表刚上线时，虽然SQL的执行时间较短，但随着数据量的增长和查询频次的增加，问题可能会逐渐暴露。


因此，提前通过执行计划分析潜在的性能瓶颈，可以有效避免后期的查询性能下降。接下来，我们就来试一下如何查看和分析执行计划。



> explain sql；


![image](https://img2024.cnblogs.com/blog/1423484/202411/1423484-20241109131103260-1105284745.png)


这是预期的执行计划。如果你希望查看实际执行过程中的真实效果，可以使用以下命令来获取更详细的执行情况和性能分析。



> explain analyze sql；


这个命令如果你想要执行，切记在执行之前开启事务，以确保在测试过程中不会对数据库产生实际的修改或影响。执行完毕后，请务必回滚事务，以恢复数据的原始状态，从而避免对数据库环境造成任何不可预见的变化或损害。


## 退出Ksql


如果需要退出Ksql命令行，输入 \\q 即可


![image](https://img2024.cnblogs.com/blog/1423484/202411/1423484-20241109131108235-1314539263.png)


# 总结


通过今天的学习，我们已经对 KSQL 工具有了初步的了解，并掌握了基本的操作技巧。我们从连接数据库、创建表结构到执行 SQL 脚本，再到灵活运用变量和进行性能优化等方面，逐步熟悉了 KSQL 的强大功能。与传统的 SQL 工具相比，KSQL 提供了更高效的工作流，尤其是在处理数据库查询和调试时，灵活的命令行操作和可视化功能为开发者节省了大量的时间和精力。


此外，KSQL 还支持实时执行 SQL 查询并生成 HTML 格式的结果，极大地方便了数据的可视化展示。通过引入执行计划和 SQL 执行时间的监控，我们可以及时识别潜在的性能问题，确保系统在生产环境中的稳定性。


总之，KSQL 是一个功能强大且易于上手的数据库客户端工具，尤其适合需要频繁与数据库进行交互的开发人员和数据库管理员。希望通过今天的实践，大家能更好地掌握 KSQL，并将其应用到实际项目中，提高工作效率和系统性能。




---


我是努力的小雨，一名 Java 服务端码农，潜心研究着 AI 技术的奥秘。我热爱技术交流与分享，对开源社区充满热情。同时也是一位腾讯云创作之星、阿里云专家博主、华为云云享专家、掘金优秀作者。


💡 我将不吝分享我在技术道路上的个人探索与经验，希望能为你的学习与成长带来一些启发与帮助。


🌟 欢迎关注努力的小雨！🌟


